{"version":3,"sources":["..\\..\\..\\..\\assets\\Scripts/assets\\Scripts\\UserInfo.js"],"names":["imageLoader","require","cc","Class","extends","Component","properties","rankPrefab","Prefab","loseLink","Node","backAudio","url","AudioClip","default","worldRankPrefab","onLoad","gameClubButton","CC_WECHATGAME","width","height","wx","getSystemInfo","success","res","console","log","brand","screenWidth","screenHeight","fail","complete","createGameClubButton","type","text","image","icon","style","left","top","hide","_isCapturing","self","game","addPersistRootNode","node","active","nameUser","rivalName","tokenMsg","pictureUser","nUserScore","matchState","userMsg","pictureEnemy","isLoad","nGameType","userImage","rivalImage","rivalGameType","openid","isOver","tetrisTopScore","sys","localStorage","getItem","undefined","figureTopScore","stoneTopScore","os","OS_ANDROID","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","director","loadScene","bind","showShareMenu","withShareTicket","onShareAppMessage","title","imageUrl","audioEngine","play","event","keyCode","KEY","back","end","onDestroy","off","StandAloneLoad","LoadUser","iconUrl","nickname","nodeName","nodePicture","getComponent","Label","string","LoadUserPicture","LoadTwoUser","iconUr2","nodeName1","nodePicture1","nodePicture2","isNative","loadUserPictureByWx","LoadThreeUser","iconUr3","nodePicture3","iconUr","imageLoadTool","spriteFrame","Sprite","setPrefabPosition","prefab","x","y","parentNode","createPrefab","setPosition","addChild","prefabNode","instantiate","showRank","rankNode","showWorldRank","vsNode","find","xhr","XMLHttpRequest","onreadystatechange","readyState","status","response","responseText","offset","responseData","JSON","parse","result","data","i","openId","name","avatarUrl","integral","worldNode","getChildByName","rownum","toString","createImage","onload","texture","Texture2D","initWithElement","handleLoadedTexture","SpriteFrame","src","length","substring","open","send","cacelShowWorldRank","Button","interactable","canClick","imageLoadToolForWechatGame","LoadRivalPicture","loadRivalPictureByWx","rivalImageForWechatGame","LoadUserPictureAsync","Promise","resolve","reject","loader","load","err","sprite","shareFriends","shareAppMessage","nativeShare","isBrowser","fileName","fullPath","jsb","fileUtils","getWritablePath","isFileExist","removeFile","size","getWinSize","RenderTexture","p","begin","getRunningScene","visit","saveToFile","IMAGE_FORMAT_JPG","tryTimes","fn","reflection","callStaticMethod","OS_IOS","setTimeout","showAdvice","bannerHeight","bannerWidth","winSize","getSystemInfoSync","advice","createAdvertisement","destroy","createBannerAd","adUnitId","windowWidth","windowHeight","show","onError","onResize","realHeight","start","postMessage","action","score","openDataContext","getOpenDataContext"],"mappings":"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","file":"UserInfo.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["/*\r\n * @Author: mikey.zhaopeng \r\n * @Date: 2018-06-26 18:57:39 \r\n * @Last Modified by: mikey.zhaopeng\r\n * @Last Modified time: 2018-08-20 09:40:10\r\n */\r\n//图片加载工具\r\nvar imageLoader = require(\"./ImageLoader\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        rankPrefab : cc.Prefab,\r\n        loseLink : cc.Node,\r\n        backAudio : {\r\n            url : cc.AudioClip,\r\n            default : null,\r\n        },\r\n        worldRankPrefab : cc.Prefab,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.gameClubButton = null;\r\n        //加载游戏圈\r\n        if(CC_WECHATGAME){\r\n            let width = 0;\r\n            let height = 0;\r\n            wx.getSystemInfo({\r\n                success : function(res){\r\n                    console.log(\"手机的品牌是：\",res.brand);\r\n                    width = res.screenWidth;\r\n                    height = res.screenHeight;\r\n                    console.log(\"width is \",width);\r\n                    console.log(\"height is \",height);\r\n                },\r\n                fail : function(){\r\n\r\n                },\r\n                complete : function(){\r\n\r\n                }\r\n            })\r\n            //加入游戏圈功能\r\n            this.gameClubButton = wx.createGameClubButton({\r\n                type : \"image\",\r\n                text : \"\",\r\n                image : \"\",\r\n                icon  : 'dark',\r\n                style : {\r\n                    left : width/2-20,\r\n                    top  : height-80,\r\n                    width : 40,\r\n                    height : 40,\r\n                }\r\n\r\n            });\r\n            this.gameClubButton.hide();\r\n        }\r\n        this._isCapturing = false;\r\n        var self = this;\r\n        //将此节点作为常驻节点\r\n        cc.game.addPersistRootNode(this.node);  \r\n        this.loseLink.active = false;\r\n        //初始化用户名字\r\n        this.nameUser=\"\";\r\n        //初始化敌人的信息\r\n        this.rivalName = \"\";\r\n        //初始化用户token\r\n        this.tokenMsg=\"\";\r\n        //初始化用户头像\r\n        this.pictureUser=\"\";\r\n        //初始化用户计分\r\n        this.nUserScore=0;\r\n        //初始化玩家匹配状态\r\n        this.matchState=\"\";\r\n        //初始化服务器广播的用户自己的信息\r\n        this.userMsg;\r\n        //初始化服务器广播的敌人的信息\r\n        this.pictureEnemy=\"\";\r\n        //判断用户进入匹配界面是否加载完场景\r\n        this.isLoad=false;\r\n        //初始化用户的游戏类型\r\n        this.nGameType=\"0\";\r\n        //用户头像图片\r\n        this.userImage=null;\r\n        //对手头像图片\r\n        this.rivalImage = null;\r\n        //敌人的游戏类型\r\n        this.rivalGameType = \"0\";\r\n        this.openid = \"\";\r\n        //是否游戏结束或者死亡\r\n        this.isOver = false;\r\n        //单机版的俄罗斯方块最高分记录\r\n        this.tetrisTopScore = cc.sys.localStorage.getItem('maxScoreTetris') === undefined ? \"0\" : cc.sys.localStorage.getItem('maxScoreTetris');\r\n        //单机版的画像方块的最高分记录\r\n        this.figureTopScore = cc.sys.localStorage.getItem('maxScoreFigure') === undefined ? \"0\" : cc.sys.localStorage.getItem('maxScoreFigure');\r\n        //单机版的宝石方块的最高分记录\r\n        this.stoneTopScore = cc.sys.localStorage.getItem('maxScoreStone') === undefined ? \"0\" : cc.sys.localStorage.getItem('maxScoreStone');\r\n        if(cc.sys.os === cc.sys.OS_ANDROID){\r\n            // cc.eventManager.addListener({\r\n            //     event : cc.EventListener.KEYBOARD,\r\n            //     onKeyPressed : function(keyCode,event){\r\n            //         if(keyCode === cc.KEY.back){\r\n            //             cc.director.end();\r\n            //         }\r\n            //     },\r\n            //     onKeyReleased : function(keyCode,event){\r\n\r\n            //     },\r\n            // },this)\r\n            console.log(\"进入原生安卓环境\");\r\n            cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this);\r\n            cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this);\r\n        }\r\n        //断网监听\r\n        this.loseLink.on(\"touchstart\",function(){\r\n            this.loseLink.active = false;\r\n            cc.director.loadScene(\"Login\");\r\n        }.bind(this));\r\n        if(CC_WECHATGAME){\r\n            wx.showShareMenu({\r\n                withShareTicket : true\r\n            });\r\n            wx.onShareAppMessage(function(){\r\n                return {\r\n                    title : '跟我一起玩方块大爆炸吧',\r\n                    imageUrl : 'https://wx.qlogo.cn/mmhead/Q3auHgzwzM5iaibNxrPibic6NRlaOjEiaAnwBH5SkBIeVUVYXNEMUDN406w/0',\r\n                }\r\n            });\r\n        }\r\n        cc.audioEngine.play(this.backAudio,true,0.6);\r\n    },\r\n    onKeyDown : function(event){\r\n        switch(event.keyCode){\r\n            case cc.KEY.back:\r\n                //如果用户点击了返回按钮退出游戏\r\n                console.log(\"开始返回手机桌面\");\r\n                cc.director.end();\r\n                break;\r\n        }\r\n    },\r\n    onKeyUp   : function(event){\r\n        switch(event.keyCode){\r\n            case cc.KEY.back:\r\n                //如果用户点击了返回按钮退出游戏\r\n                break;\r\n        }\r\n    },\r\n    onDestroy(){\r\n        console.log(\"销毁监听事件\");\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this);\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this);\r\n    },\r\n    //单机加载用户信息\r\n    StandAloneLoad:function(){\r\n\r\n    },\r\n    //加载一个用户信息\r\nLoadUser: function(iconUrl,nickname,nodeName,nodePicture){\r\n    // var self = this;\r\n    // this.qqNickname.getComponent(cc.Label).fontSize = 20;\r\n    nodeName.getComponent(cc.Label).string = nickname;\r\n    this.LoadUserPicture(iconUrl,nodePicture);\r\n    // //远程加载资源\r\n    // cc.loader.load({url:iconUrl,type:'jpg'},function(err,texture){\r\n    //      var spriteFra = nodePicture.getComponent(cc.Sprite).spriteFrame;\r\n    //      spriteFra.setTexture(texture);\r\n    // }.bind(this));\r\n},\r\n//加载两个用户头像\r\nLoadTwoUser:function(iconUrl,iconUr2,nodeName1,nickname,nodePicture1,nodePicture2){\r\n    console.log(\"in LoadTwoUser iconUrl is \" + iconUrl);\r\n    console.log(\"in LoadTwoUser iconUr2 is \" + iconUr2);\r\n    console.log(\"in LoadTwoUser nodeName1 is \" + nodeName1);\r\n    console.log(\"in LoadTwoUser nickname is \" + nickname);\r\n    console.log(\"in LoadTwoUser nodePicture1 is \" + nodePicture1);\r\n    console.log(\"in LoadTwoUser nodePicture2 is \" + nodePicture2);\r\n    // var self = this;\r\n    // this.qqNickname.getComponent(cc.Label).fontSize = 20;\r\n    nodeName1.getComponent(cc.Label).string = nickname;\r\n    console.log(nodeName1.getComponent(cc.Label).string+\"nickname5555555555555555555555\");\r\n    if(cc.sys.isNative){\r\n        this.LoadUserPicture(iconUrl,nodePicture1);\r\n        this.LoadUserPicture(iconUr2,nodePicture2);\r\n    }\r\n    if(CC_WECHATGAME){\r\n        this.loadUserPictureByWx(iconUrl,nodePicture1);\r\n        this.loadUserPictureByWx(iconUr2,nodePicture2);\r\n    }\r\n//     //远程加载资源\r\n//     cc.loader.load({url:iconUrl,type:'jpg'},function(err,texture){\r\n//          var spriteFra = nodePicture1.getComponent(cc.Sprite).spriteFrame;\r\n//          spriteFra.setTexture(texture);\r\n//     }.bind(this));\r\n//     cc.loader.load({url:iconUr2,type:'jpg'},function(err,texture){\r\n//         var spriteFra = nodePicture2.getComponent(cc.Sprite).spriteFrame;\r\n//         spriteFra.setTexture(texture);\r\n//    }.bind(this));\r\n},\r\n//加载三个用户头像\r\nLoadThreeUser:function(iconUrl,iconUr2,iconUr3,nodePicture1,nodePicture2,nodePicture3,nickname,nodeName1){\r\n    var self = this;\r\n    cc.log(iconUr3+\"4444444444444444444444444444444444444444444444444\");\r\n    cc.log(nodePicture1);\r\n    cc.log(nickname);\r\n    // this.qqNickname.getComponent(cc.Label).fontSize = 20;\r\n    nodeName1.getComponent(cc.Label).string = nickname;\r\n    this.LoadUserPicture(iconUrl,nodePicture1);\r\n    this.LoadUserPicture(iconUr2,nodePicture2);\r\n    this.LoadUserPicture(iconUr3,nodePicture3);\r\n},\r\n//加载用户头像\r\nLoadUserPicture:function(iconUr,nodePicture){\r\n    // if(iconUr!=\"\")\r\n    // {\r\n    //     cc.loader.load({url:iconUr,type:'jpg'},function(err,texture){\r\n    //         if(err){\r\n    //             console.log(\"加载头像出错\");\r\n    //         }\r\n    //         console.log(\"============================加载用户头像==========================================\");\r\n    //         //将用户的头像保存起来以后用的时候不用再重复加载了\r\n    //         console.log(\"===========================获取用户头像信息=====================================================\");\r\n    //         var sprite = nodePicture.getComponent(cc.Sprite);\r\n    //         sprite.spriteFrame = new cc.SpriteFrame(texture);\r\n    //    }.bind(this));\r\n    // }\r\n    //如果是相同的请求路径就从本地中提取图片\r\n    if(cc.sys.isNative){\r\n        imageLoader.imageLoadTool(iconUr,function(spriteFrame){\r\n              nodePicture.getComponent(cc.Sprite).spriteFrame = spriteFrame;  \r\n        }.bind(this));\r\n    }\r\n    if(CC_WECHATGAME){\r\n        this.loadUserPictureByWx(iconUr,nodePicture);\r\n    }\r\n},\r\n /**\r\n@param prefab:将要生成预制节点的预制体\r\n@param x     :将要生成预制节点的x坐标\r\n@param y     :将要生成预制节点的y坐标\r\n@param parentNode : 生成的预制节点的父节点\r\n    */\r\nsetPrefabPosition : function(prefab,x,y,parentNode){\r\n    var prefab = this.createPrefab(prefab);\r\n    prefab.setPosition(x,y);\r\n    parentNode.addChild(prefab);\r\n    return prefab;\r\n},\r\n//创建一个预制体节点\r\ncreatePrefab : function(prefab){\r\n    var prefabNode = cc.instantiate(prefab);\r\n    return prefabNode;\r\n},\r\nshowRank : function(){\r\n    //得到排行榜节点方便显示隐藏用\r\n    this.rankNode = this.setPrefabPosition(this.rankPrefab,0,400,this.node);\r\n},\r\nshowWorldRank : function(){\r\n    var self = this;\r\n    var vsNode = cc.find(\"PebmanentNode/vs\");\r\n    //显示世界排行榜页面\r\n    cc.find(\"PebmanentNode/vs\").active = true;\r\n    //显示黑色背景\r\n    cc.find(\"PebmanentNode/dark\").active = true;\r\n    // let responseData = [{\r\n    //     name : 'Eagles',\r\n    //     integral : '220',\r\n    //     avaturl : \"https://wx.qlogo.cn/mmopen/vi_32/rLH62uZPiaCJwc6SYVReibibtibUrCYj4aCh3TBL4ZGSeokVkCEL3BibLtLEHlndyFxNNz4a9bA3gAJO1t8BaQFF9KQ/132\",\r\n    // },\r\n    // {\r\n    //     name : 'WY',\r\n    //     integral : '210',\r\n    //     avaturl : \"https://wx.qlogo.cn/mmopen/vi_32/rLH62uZPiaCJwc6SYVReibibtibUrCYj4aCh3TBL4ZGSeokVkCEL3BibLtLEHlndyFxNNz4a9bA3gAJO1t8BaQFF9KQ/132\",\r\n    // }]\r\n    \r\n    // for(let i = 0;i < responseData.length;i++){\r\n    //     //获得openId\r\n    //     // let openId = responseData[i].openid;\r\n    //     //用户名\r\n    //     let name = responseData[i].name;\r\n    //     //积分\r\n    //     let integral = responseData[i].integral;\r\n    //     let url = responseData[i].avaturl;\r\n    //     //显示世界排行榜数据\r\n    //     let worldNode = self.setPrefabPosition(self.worldRankPrefab,3,385 - i * offset,vsNode);\r\n    //     console.log(\"世界排行榜节点是：\",worldNode);\r\n    //     worldNode.getChildByName(\"rankNum\").getComponent(cc.Label).string = i + 1;\r\n    //     self.loadRivalPictureByWx(url,worldNode.getChildByName(\"userImage\"));\r\n    //     worldNode.getChildByName(\"nickName\").getComponent(cc.Label).string = name;\r\n    //     worldNode.getChildByName(\"score\").getComponent(cc.Label).string = integral;\r\n    // }\r\n    //向服务器请求世界排行数据\r\n    let url = \"https://m5.ykplay.com/getWorldRankByName?openid=\"+this.openid;\r\n    console.log(\"this.openid is \",this.openid);\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.onreadystatechange = function () {\r\n        if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status < 400)) {\r\n            var response = xhr.responseText;\r\n            console.log(response);\r\n            console.log(typeof response);\r\n            let offset = 192;\r\n            var responseData = JSON.parse(response);\r\n            console.log(\"responseData is \",responseData);\r\n            if(responseData.result === 'ok'){\r\n                if(responseData.data != null){\r\n                    for(let i = 0;i < responseData.data.length;i++){\r\n                        //获得openId\r\n                        let openId = responseData.data[i].openid;\r\n                        //用户名\r\n                        let name = responseData.data[i].name;\r\n                        console.log(\"in UserInfo name is \",name);\r\n                        let avatarUrl = responseData.data[i].avatarUrl;\r\n                        console.log(\"in UserInfo avatarUrl is \",avatarUrl);\r\n                        //积分\r\n                        let integral = responseData.data[i].integral;\r\n                        console.log(\"in UserInfo integral is \",integral);\r\n                        //显示世界排行榜数据\r\n                        let worldNode = self.setPrefabPosition(self.worldRankPrefab,0,385 - i * offset,vsNode);\r\n                        console.log(\"世界排行榜节点是：\",worldNode);\r\n                        worldNode.getChildByName(\"rankNum\").getComponent(cc.Label).string = responseData.data[i].rownum.toString();\r\n                        if(CC_WECHATGAME){\r\n                            let image =wx.createImage();\r\n                            image.onload = function(){\r\n                                let texture = new cc.Texture2D();\r\n                                texture.initWithElement(image);\r\n                                texture.handleLoadedTexture();\r\n                                worldNode.getChildByName(\"userImage\").getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture);\r\n                            }\r\n                            image.src = avatarUrl;\r\n                        }\r\n                        // cc.loader.load({url:avatarUrl,type:'jpg'},function(err,tex){\r\n                        //     if(err){\r\n                        //         console.log(err);\r\n                        //     }\r\n                        //     console.log(\"tex is \",tex);\r\n                        //     let sprite = worldNode.getChildByName(\"userImage\").getComponent(cc.Sprite);\r\n                        //     console.log(\"sprite is \",sprite);\r\n                        //     sprite.spriteFrame.setTexture(tex);\r\n                        // });\r\n                        // self.loadUserPictureByWx(avatarUrl,worldNode.getChildByName(\"userImage\"));\r\n                        if(name.length >=5){\r\n                            name = name.substring(0,5) + \"...\";\r\n                            worldNode.getChildByName(\"nickName\").getComponent(cc.Label).string = name;\r\n                        }else{\r\n                            worldNode.getChildByName(\"nickName\").getComponent(cc.Label).string = name;\r\n                        }\r\n                        worldNode.getChildByName(\"score\").getComponent(cc.Label).string = integral;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    xhr.open(\"GET\", url, true);\r\n    xhr.send();\r\n},\r\ncacelShowWorldRank : function(){\r\n    //关闭世界排行榜页面\r\n    cc.find(\"PebmanentNode/vs\").active = false;\r\n    cc.find(\"PebmanentNode/dark\").active = false;\r\n    //将那些按钮开启\r\n    cc.find(\"Canvas/OneGame\").getComponent(cc.Button).interactable = true;\r\n    cc.find(\"Canvas/PersobsGame\").getComponent(cc.Button).interactable = true;\r\n    cc.find(\"Canvas/Help\").getComponent(cc.Button).interactable = true;\r\n    cc.find(\"Canvas/Back\").getComponent(cc.Button).interactable = true;\r\n    cc.find(\"Canvas/menuBottom/RankList\").getComponent(cc.Button).interactable = true;\r\n    cc.find(\"Canvas/menuBottom/Friend\").getComponent(cc.Button).interactable = true;\r\n    cc.find(\"Canvas\").getComponent(\"TurnScene\").canClick = true;\r\n},\r\nloadUserPictureByWx : function(iconUrl,nodePicture){\r\n    imageLoader.imageLoadToolForWechatGame(iconUrl,function(spriteFrame){\r\n        console.log(\"spriteFrame is \",spriteFrame);\r\n        nodePicture.getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n    });\r\n},\r\nLoadRivalPicture : function(iconUr,nodePicture){\r\n    if(CC_WECHATGAME){\r\n        this.loadRivalPictureByWx(iconUr,nodePicture);\r\n    }\r\n},\r\nloadRivalPictureByWx : function(iconUrl,nodePicture){\r\n    imageLoader.rivalImageForWechatGame(iconUrl,function(spriteFrame){\r\n        console.log(\"spriteFrame is \",spriteFrame);\r\n        nodePicture.getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n    });\r\n},\r\n//加载用户头像\r\nLoadUserPictureAsync:function(iconUr,nodePicture){\r\n    if(iconUr!=\"\")\r\n    {\r\n        var self = this;\r\n        //返回一个Promise\r\n        return new Promise(function(resolve,reject){\r\n            cc.loader.load({url:iconUr,type:'jpg'},function(err,texture){\r\n                if(err){\r\n                    console.log(\"加载头像出错\");\r\n                }\r\n                console.log(\"============================加载用户头像==========================================\",self.nameUser);\r\n                //将用户的头像保存起来以后用的时候不用再重复加载了\r\n                console.log(\"===========================获取用户头像信息=====================================================\",self.nameUser);\r\n                var sprite = nodePicture.getComponent(cc.Sprite);\r\n                console.log(\"广播。。sprite\"+sprite,self.nameUser);\r\n                console.log(\"广播。。nodePicture\"+nodePicture,self.nameUser);\r\n                console.log(\"广播。。texture\"+texture,self.nameUser);\r\n                sprite.spriteFrame = new cc.SpriteFrame(texture);\r\n                console.log(\"广播。。spriteFrame\"+sprite.spriteFrame,self.nameUser);\r\n                resolve(\"加载头像成功\"+self.nameUser);\r\n           }.bind(self));\r\n        });\r\n    }\r\n    console.log(\"广播。。该URL为空的\");\r\n},\r\n//分享朋友圈接口主动拉起微信分享\r\nshareFriends : function(){\r\n    if(CC_WECHATGAME){\r\n        //微信小游戏平台\r\n        wx.shareAppMessage({\r\n            title    : '今天的方块,你来了吗？',\r\n            imageUrl : 'https://wx.qlogo.cn/mmhead/Q3auHgzwzM7B4kyK03XibIzA3UGTia3BxicVjjfPYxPxIvEVDw5nOc0Ww/0',\r\n        });\r\n    }else if(cc.sys.isNative){\r\n        //如果是原生平台的话就调用原生平台的方法\r\n        this.nativeShare();\r\n    }\r\n},\r\n//原生平台分享\r\nnativeShare : function(){\r\n    // 微信分享屏幕截图  \r\n        // 网页端不支持  \r\n        if (cc.sys.isBrowser) {  \r\n            cc.log('网页端不支持微信分享~');  \r\n            return;  \r\n        }  \r\n  \r\n        // 正在截图中判断  \r\n        if (this._isCapturing) {  \r\n            return;  \r\n        }  \r\n        this._isCapturing = true;  \r\n  \r\n        // 截图文件判断  \r\n        var fileName = \"shareScreenshot.jpg\";  \r\n        var fullPath = jsb.fileUtils.getWritablePath() + fileName;  \r\n        if (jsb.fileUtils.isFileExist(fullPath)) {  \r\n            jsb.fileUtils.removeFile(fullPath);  \r\n        }  \r\n  \r\n        // 截图并保存图片文件  \r\n        var size = cc.director.getWinSize(); // 获取视图大小  \r\n        var texture = new cc.RenderTexture(size.width, size.height); // 新建渲染纹理  \r\n        texture.setPosition(cc.p(size.width / 2, size.height / 2)); // 移动渲染纹理到视图中心  \r\n        texture.begin(); // 开始渲染  \r\n        cc.director.getRunningScene().visit(); // 访问当前场景  \r\n        texture.end(); // 渲染结束  \r\n        texture.saveToFile(fileName, cc.IMAGE_FORMAT_JPG); // 保存渲染纹理到图片文件  \r\n        console.log(\"渲染纹理完成\");  \r\n        // 延时50毫秒，检测截图文件是否存在  \r\n        // 重复10次这个过程，如果超过10次仍没检测到图片文件，截图失败（超时）  \r\n        var self = this;  \r\n        var tryTimes = 0;  \r\n        var fn = function () {  \r\n            if (jsb.fileUtils.isFileExist(fullPath)) {  \r\n                // 调用相应平台微信分享图片方法  \r\n                if (cc.sys.os === cc.sys.OS_ANDROID) {  \r\n                    jsb.reflection.callStaticMethod('org/cocos2dx/javascript/AppActivity', 'shareIMG', '(Ljava/lang/String;)V', fullPath);  \r\n                    console.log(\"分享成功！！！\");  \r\n                } else if (cc.sys.os === cc.sys.OS_IOS) {  \r\n                    jsb.reflection.callStaticMethod('AppController', 'shareIMG:', fullPath);  \r\n                }  \r\n                self._isCapturing = false;  \r\n            } else {  \r\n                tryTimes++;  \r\n                if (tryTimes > 10) {  \r\n                    self._isCapturing = false;  \r\n                    cc.log('截图失败，超时~');  \r\n                    return;  \r\n                }  \r\n                setTimeout(fn, 50);  \r\n            }  \r\n        };  \r\n        setTimeout(fn, 50);  \r\n        console.log(\"截图完成！！\");  \r\n},\r\n//弹出广告\r\nshowAdvice : function(){\r\n        var self = this;\r\n        let bannerHeight = 80;\r\n        let bannerWidth = 300;\r\n        if(CC_WECHATGAME){\r\n            let winSize = wx.getSystemInfoSync();\r\n            console.log(\"winSize is \",winSize);\r\n            if(this.advice === undefined){\r\n                this.createAdvertisement();\r\n            }else{\r\n                //先销毁该advertisement\r\n                this.advice.destroy();\r\n                //创建一个新的广告实例\r\n                this.createAdvertisement();\r\n            }\r\n        }\r\n},\r\ncreateAdvertisement : function(){\r\n    if(CC_WECHATGAME){\r\n        this.advice = wx.createBannerAd({\r\n            adUnitId  : \"\",\r\n            style     : {\r\n                left  : (winSize.windowWidth - bannerWidth)/2,\r\n                top   : winSize.windowHeight - bannerHeight,\r\n                width : bannerWidth, \r\n            }\r\n        });\r\n        this.advice.show();\r\n        console.log(\"advice is \",this.advice);\r\n        this.advice.onLoad(()=>{\r\n            console.log(\"banner 广告加载成功\");\r\n        });\r\n        this.advice.onError(err=>{\r\n            console.log(\"err is \",err);\r\n        });\r\n        //重新修剪广告位\r\n        self.advice.onResize(res =>{\r\n            console.log(\"res is \",res);\r\n            console.log(\"realHeight is \",self.advice.style.realHeight);\r\n            self.advice.style.top = winSize.windowHeight - self.advice.style.realHeight;\r\n        });\r\n    }\r\n},\r\nstart () {\r\n\r\n},\r\n/**\r\n * //将最高分上传到微信托管平台\r\n * @param  {事件名称} action\r\n * @param  {游戏类型} type\r\n * @param  {该游戏类型的最高分} score\r\n */\r\npostMessage : function(action, type, score) {\r\n    console.log(\"开始保存到微信托管平台\");\r\n    console.log(\"action is \",action);\r\n    console.log(\"type is \",type);\r\n    console.log(\"score is \",score);\r\n    if(!CC_WECHATGAME) return;\r\n    let openDataContext = wx.getOpenDataContext();\r\n    openDataContext.postMessage({\r\n        action: action,\r\n        data  : type,\r\n        score : score,\r\n    })\r\n}\r\n    // update (dt) {},\r\n});\r\n"]}