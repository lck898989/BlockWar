{"version":3,"sources":["Stone.js"],"names":["cc","Class","extends","Component","properties","type","isRemove","isMove","row","col","onLoad","targetX","targetY","offsetRow","time","xlTime","isRemoveDown","hasTarget","start","afterRemoveDown","map","backGroundArr","t","getComponent","innerNode","targetRow","scanDown","log","x","y","self","node","checkCanDown","downShine","test","action1","fadeTo","action2","action3","action4","action5","sequence","children","runAction","shine","a","aaa","bind","scheduleOnce","destroy","update","dt"],"mappings":"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","file":"Stone.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Scripts\\game3","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        //宝石类型\r\n        type:null,\r\n        //是否可以消除\r\n        isRemove:false,\r\n        //是否移动过\r\n        isMove : false,\r\n        //行\r\n        row : 0,\r\n        //列\r\n        col : 0,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        //目标位置X\r\n        this.targetX = 0;\r\n        //目标位置Y\r\n        this.targetY = 0;\r\n        //行偏移量\r\n        this.offsetRow = 0;\r\n        //计时\r\n        this.time = 0;\r\n        //消除下落时间\r\n        this.xlTime = 0.1;\r\n        //是否可以消除下落\r\n        this.isRemoveDown = false;\r\n        this.hasTarget = false;\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n     //消除下落操作\r\n     afterRemoveDown : function(map,backGroundArr){\r\n        //自己向下找空穴的位置\r\n        //自己占据的地图信息改为0\r\n        // if(this.checkCanDown(map)){\r\n            this.t = 0;\r\n            map[this.row][this.col] = 0;\r\n            //改变背景方格的类型状态及内置节点的引用风\r\n            backGroundArr[this.row][this.col].getComponent(\"Back\").type = -1;\r\n            backGroundArr[this.row][this.col].getComponent(\"Back\").innerNode = null;\r\n            //向下扫描找到空穴的位置\r\n            var targetRow = this.scanDown(map,this.row,this.col);\r\n            cc.log(\"targetRow is \" + targetRow);\r\n            this.targetX = backGroundArr[targetRow][this.col].x;\r\n            this.targetY = backGroundArr[targetRow][this.col].y;\r\n            //目标行与当前行的差值\r\n            this.offsetRow = targetRow - this.row;\r\n            this.hasTarget = true;\r\n            // this.isRemoveDown = true;\r\n            var self = this;\r\n            // // for(let i = 0;i<this.offsetRow;i++){\r\n            // //     (function test(){\r\n            // //         var action = cc.moveBy(0.3,cc.p(0,-self.node.height));\r\n            // //         self.node.runAction(action);\r\n            // //     })()\r\n            // // }\r\n            // function pro(){\r\n            //     //将该节点的行设置成目标行\r\n            self.row = targetRow;\r\n            map[self.row][self.col] = 1;\r\n            //设置背景方格的类型为该节点的类型\r\n            backGroundArr[self.row][self.col].getComponent(\"Back\").type = self.type;\r\n            backGroundArr[self.row][self.col].getComponent(\"Back\").innerNode = self.node;\r\n            // }\r\n            // // this.node.stopAllActions();\r\n            // (function test(pro){\r\n            //     (function(){\r\n            //         var action = cc.moveTo(0.3,cc.p(self.targetX,self.targetY));\r\n            //         self.node.runAction(action);\r\n            //     })();\r\n            //     pro();\r\n            // })(pro);\r\n        // }\r\n    },\r\n    scanDown : function(map,row,col){\r\n         //向下寻找\r\n         while(row < 11){\r\n            row++;\r\n            if(map[row][col] === 1){\r\n                break;\r\n            }\r\n            if(row === 11){\r\n                break;\r\n            }\r\n         }\r\n         //最底下的背景方格的状态不为1\r\n         if(row === 11 && map[row][col] != 1){\r\n             return 11;\r\n         }else{\r\n            return row-1;\r\n         }\r\n    },\r\n    //检测该节点是否可以下落\r\n    checkCanDown : function(map){\r\n        if(map[this.row+1][this.col] === 1){\r\n            return false;\r\n        }else{\r\n            return true;\r\n        }\r\n    },\r\n    downShine : function(){\r\n        var self = this;\r\n          (function test(){\r\n              (function t(){\r\n                var action1 = cc.fadeTo(0.2,0);\r\n                var action2 = cc.fadeTo(0,2,70);\r\n                var action3 = cc.fadeTo(0.2,100);\r\n                var action4 = cc.fadeTo(0.2,70);\r\n                var action5 = cc.fadeTo(0.2,0);\r\n                var sequence = cc.sequence(action1,action2,action3,action4,action5);\r\n                self.node.children[0].runAction(sequence);\r\n                cc.log(\"adfadfadf\");\r\n              })();\r\n        })();\r\n    },\r\n    //节点发光\r\n    shine : function(){\r\n        var self = this;\r\n          (function test(a){\r\n              (function t(){\r\n                var action1 = cc.fadeTo(0.2,100);\r\n                var action2 = cc.fadeTo(0,2,150);\r\n                var action3 = cc.fadeTo(0.2,180);\r\n                var action4 = cc.fadeTo(0.2,200);\r\n                var sequence = cc.sequence(action1,action2,action3,action4);\r\n                self.node.children[0].runAction(sequence);\r\n                cc.log(\"adfadfadf\");\r\n              })();\r\n            a();\r\n        })(self.aaa.bind(self));\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n    aaa:function(){\r\n        // this.node.destroy();\r\n        cc.log(\"发光完毕\");\r\n        this.scheduleOnce(function(){\r\n            this.node.destroy();\r\n        },0.2);\r\n        \r\n    },\r\n    update (dt) {\r\n        if(this.hasTarget){\r\n            this.t += dt;\r\n            cc.log(this.t);\r\n            cc.log(this.node.y+\"？？？？？？？？？？？？？？？？？？？？？？？？\");\r\n            cc.log(this.targetY+\"/////////////////////////\");\r\n            if(this.node.y >= this.targetY+120){\r\n                if(this.t >= 0.1){\r\n                    cc.log(\"33434343434343434434\");\r\n                    //  cc.director.getPhysicsManager().enabled = false;\r\n                    this.node.y -= 120;\r\n                    this.t = 0;\r\n                }\r\n            }\r\n        }\r\n    },\r\n});"]}