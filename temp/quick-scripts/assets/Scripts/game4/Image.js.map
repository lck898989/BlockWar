{"version":3,"sources":["Image.js"],"names":["cc","Class","extends","Component","properties","type","isRemove","isMove","isActive","angle","hasDown","row","col","quickDown","backGroundArr","map","self","getComponent","log","targetX","x","targetY","y","moveAction","moveTo","p","node","runAction","innerNode","afterRemoveDown","checkCanDown","targetRow","scanDown","action","shine","test","a","t","action1","fadeTo","action2","action3","action4","sequence","aaa","bind","rotate","centerX","centerY","scheduleOnce","destroy","onLoad","delay","start","update","dt","i","childrenCount","children","active"],"mappings":"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","file":"Image.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Scripts\\game4","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        //宝石类型\r\n        type:null,\r\n        //是否可以消除\r\n        isRemove:false,\r\n        //是否移动过\r\n        isMove : false,\r\n        //是否可以激活\r\n        isActive : false,\r\n        /**\r\n         * 0 : 0度方向\r\n         * 1 : 90度方向\r\n         * 2 : 180度方向\r\n         * 3 : 270度方向\r\n         * 4 : 360度方向也就是0度方向\r\n         */\r\n        angle    : 0,\r\n        //是否可以快速下落\r\n        hasDown : false,\r\n        //该节点所处的行和列\r\n        row : 0,\r\n        col : 0,      \r\n        // active : false,\r\n    },\r\n    quickDown : function(row,col,backGroundArr,map){\r\n        //改变当前行\r\n        var self = this;\r\n        backGroundArr[self.row][self.col].getComponent(\"Back\").type = -1;\r\n        cc.log(\"map is \" + map);\r\n        var targetX = backGroundArr[row][col].x;\r\n        var targetY = backGroundArr[row][col].y;\r\n        \r\n        var moveAction = cc.moveTo(0.0001,cc.p(targetX,targetY));\r\n        self.node.runAction(moveAction);\r\n        //该节点已经下落过了，以后更新地图的时候不更新\r\n        self.hasDown = true;\r\n        // this.node.x = targetX;\r\n        // this.node.y = targetY;\r\n        map[row][col] = 1;\r\n        //设置背景方格的类型为该节点的类型\r\n        backGroundArr[row][col].getComponent(\"Back\").type = this.type;\r\n        backGroundArr[row][col].getComponent(\"Back\").innerNode = this.node;\r\n        //设置当前的行为下落之后的行\r\n        this.row = row;\r\n        \r\n    },\r\n    //消除下落操作\r\n    afterRemoveDown : function(map,backGroundArr){\r\n        if(this.isActive){\r\n            cc.log(\"不可消除块下落了，需要你引起注意\");\r\n        }\r\n        //自己向下找空穴的位置\r\n        //自己占据的地图信息改为0\r\n        if(this.checkCanDown(map)){\r\n            map[this.row][this.col] = 0;\r\n            //改变背景方格的类型状态及内置节点的引用风\r\n            backGroundArr[this.row][this.col].getComponent(\"Back\").type = -1;\r\n            backGroundArr[this.row][this.col].getComponent(\"Back\").innerNode = null;\r\n            //向下扫描找到空穴的位置\r\n            var targetRow = this.scanDown(map,this.row,this.col);\r\n            cc.log(\"targetRow is \" + targetRow);\r\n            var targetX = backGroundArr[targetRow][this.col].x;\r\n            var targetY = backGroundArr[targetRow][this.col].y;\r\n            // var distance = targetRow - this.row;\r\n            // if (cc._renderType === cc.game.RENDER_TYPE_CANVAS) {\r\n            //     cc.renderer.enableDirtyRegion(false);\r\n            // }\r\n            var action = cc.moveTo(0.3,cc.p(targetX,targetY));\r\n            this.node.runAction(action);\r\n            // this.node.y = targetY;\r\n            //将该节点的行设置成目标行\r\n            this.row = targetRow;\r\n            map[this.row][this.col] = 1;\r\n            //设置背景方格的类型为该节点的类型\r\n            backGroundArr[this.row][this.col].getComponent(\"Back\").type = this.type;\r\n            backGroundArr[this.row][this.col].getComponent(\"Back\").innerNode = this.node;\r\n            //如果该节点的坐标超出游戏场景底部那么把它拉回到11行去\r\n            // if(this.node.y <= backGroundArr[11][this.col].y){\r\n            //     this.node.y = backGroundArr[11][this.col].y;\r\n            // }\r\n        }\r\n        \r\n    },\r\n    scanDown : function(map,row,col){\r\n         //向下寻找\r\n         while(row < 11){\r\n            row++;\r\n            if(map[row][col] === 1){\r\n                break;\r\n            }\r\n            if(row === 11){\r\n                break;\r\n            }\r\n         }\r\n         //最底下的背景方格的状态不为1\r\n         if(row === 11 && map[row][col] != 1){\r\n             return 11;\r\n         }else{\r\n            return row-1;\r\n         }\r\n    },\r\n    //检测该节点是否可以下落\r\n    checkCanDown : function(map){\r\n        if(map[this.row+1][this.col] === 1){\r\n            return false;\r\n        }else{\r\n            return true;\r\n        }\r\n    },\r\n    //节点发光\r\n    shine : function(){\r\n        var self = this;\r\n          (function test(a){\r\n              (function t(){\r\n                var action1 = cc.fadeTo(0.1,70);\r\n                var action2 = cc.fadeTo(0,1,100);\r\n                var action3 = cc.fadeTo(0.1,130);\r\n                var action4 = cc.fadeTo(0.1,160);\r\n                var sequence = cc.sequence(action1,action2,action3,action4);\r\n                self.node.runAction(sequence);\r\n                cc.log(\"adfadfadf\");\r\n              })();\r\n            a();\r\n        })(self.aaa.bind(self));\r\n    },\r\n    //旋转操作\r\n    rotate : function(centerX,centerY,backGroundArr){\r\n\r\n\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n    aaa:function(){\r\n        // this.node.destroy();\r\n        cc.log(\"发光完毕\");\r\n        this.scheduleOnce(function(){\r\n            this.node.destroy();\r\n        },0.2);\r\n        \r\n    },\r\n    onLoad () {\r\n        // cc.log(\"%%%%%%%%%%%\");\r\n        this.delay = 0;\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    update (dt) {\r\n            // this.delay += dt;\r\n            // cc.log(\"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\");\r\n            // cc.log(\"this.isRemove is \" + this.isRemove);\r\n            // //如果该节点是消除状态的时候让它发光\r\n            // if(this.delay > 0.5){\r\n            //     if(this.isRemove){\r\n            //         this.shine();\r\n            //     }\r\n            //     this.delay = 0;\r\n            // }\r\n            if(!this.isActive && this.type >= 4){\r\n                //不显示它们的子节点\r\n                for(let i = 0;i<this.node.childrenCount;i++){\r\n                    this.node.children[i].active = false;\r\n                }\r\n            }\r\n            // if(this.isActive && this.type >= 4){\r\n            //     for(let i = 0;i<this.node.childrenCount;i++){\r\n            //         this.node.children[i].active = true;\r\n            //     }\r\n            // }\r\n    },\r\n});\r\n"]}